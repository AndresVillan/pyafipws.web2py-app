<SCRIPT TYPE="text/javascript" _id="script_pre_carga_permiso">
// autocalcular al descargar el formulario
// (para carga de productos desde la base de datos)

$(document).ready(function(){
  try{
    var tipoReg = "{{=form.vars.tipo_reg or ''}}";
    var idPermiso = "{{=form.vars.id_permiso or ''}}";
    var dstMerc = "{{=form.vars.dst_merc or ''}}";
  }
  catch(e){
  /* error al descargar variables */
  }


  function actualizarPermiso(){
    // (antes del ingreso a la base de datos)
    if (idPermiso != ""){
      // completar formulario de ingreso de detalle

      /* Importante: ¡Estos elementos cambian
      con las modificaciones del model y los form en web2py! */

      /* Actualizar el form */
      $("#formulario_ingreso_detalle_permiso [name=id_permiso]").val(idPermiso);
      $("#formulario_ingreso_detalle_permiso [name=tipo_reg]").val(tipoReg);
      $("#formulario_ingreso_detalle_permiso [name=dst_merc]").val(dstMerc);

      /* window.alert($("#formulario_ingreso_detalle_tributo [name=tributo]").val() +  " " + $("#formulario_ingreso_detalle_tributo [name=base_imp]").val() + " " + $("#formulario_ingreso_detalle_tributo [name=importe]").val()); */

      // actualizar previsualización
      $("#previo_id_permiso").val(idPermiso);
      $("#previo_tipo_reg").val(tipoReg);
      $("#previo_dstMerc").val(dstMerc);
    }
  }

  // cargar el ítem si se presionó el botón ingresar
  $('#boton_ingresar_detalle_permiso').bind('click', function(event){
    // actualizar los valores de qty y bonif
    dstMerc = $("#previo_dst_merc").val();
    idPermiso = $("#previo_id_permiso").val();
    tipoReg = $("#previo_tipo_reg").val();
    actualizarPermiso();
    $('#formulario_ingreso_detalle_permiso').submit();
  });
  /* actualizarPermiso(); */
});
</SCRIPT>
 
